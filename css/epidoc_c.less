@namespace oxy url('http://www.oxygenxml.com/extensions/author');
@namespace file url('http://exist-db.org/xquery/file');
@namespace tei url('http://www.tei-c.org/ns/1.0');

@import (inline) 'tei.css';


@backendUrl: "http://papyri.uni-koeln.de";

oxy|document {
    background-color: #BBBBBB !important;
    padding-left: 1em !important;
    margin-right: 1em !important;
}
oxy|comment {
    display: none !important;
}
TEI {
    font-size: 1em;
    font-family: sans-serif;
    padding: 1.5em 0em;
    margin: 0;
}
TEI:before {
    content: oxy_label(text, "Datensatz-ID: ", width, 6.75em, text-align, right) attr('xml:id') " (im Browser öffnen)"
             oxy_editor(type, button, actionID, insert_info_TEI_id, transparent, true, color, #FFFFFF)
             " " attr("rend")
            ;
    -oxy-editable: false;
    link: "http://papyri.uni-koeln.de/stueck/"attr('xml:id');
}
teiHeader, text, facsimile {
    margin: 0.5em;
    padding: 0;
    background-color: #FFFFFF;
}
teiHeader > *, text > *, facsimile > * {
    margin: 1em;
}
fileDesc, body, surface {
    padding: 0.3em;
}
teiHeader:before, text:before, facsimile:before {
    color: #FFFFFF;
    font-weight: bold;
    font-size: 1em;
    background-color: #004D26;
    padding: 0.3em 0.7em 0.3em 0.5em;
    margin: 0;
    vertical-align: top;
    display: block;
}
teiHeader:before {
    content: "TEXTTRÄGER"
             " (ID: " oxy_xpath("//msDesc/@xml:id") ")"
             ; 
}
text:before {
    content: "EDITION"
              oxy_label(text, "Entspricht Text: ", width, 12em, text-align, right)
             oxy_combobox(edit, "@corresp", editable, false, 
                values, oxy_xpath("string-join(//msItemStruct/@xml:id/concat('#', .), ',')"),
                labels, oxy_xpath("string-join(//msItemStruct/string-join((@xml:id, string-join((locus/text(), (title/text(), '(kein Titel)')[1]), ': ')), ' – '), ',')")
             )
             " " attr("rend");
}
facsimile:before {
    content: "FAKSIMILE";
}

/* GRUPPEN
*******************************************************************************************************************************************/

/* Blockelemente */
teiHeader, text, facsimile, fileDesc, encodingDesc, profileDesc, revisionDesc, sourceDesc, idno, 
div[type=edition], div[type=translation], div[type=apparatus], div[type=commentary], div[type=bibliography], div[type=textpart],
p, surface, graphic:before, graphic, div[type=edition]:before, div[type=translation]:before, div[type=apparatus]:before, div[type=commentary]:before, div[type=bibliography]:before,
lg, l, locus, 
width, height, depth, desc, note[type=topic], note[type=status] {
    display: block;
}
/* keinen Text anzeigen */
idno,
note[type=text_type], note[type=status], locus, ab[type=custody],
note[type=writing_direction], objectType, width, height, depth, note[type=preparation], desc,
acquisition note[type=acquisition_type], acquisition note[type=seller], acquisition note[type=selling_date], acquisition note[type=folder],
  note[type=finding_date], note[type=finding_place], note[type=finder], note[type=buying_date], note[type=buying_place],
note[type=seller], note[type=buyer], note[type=box], note[type=drawing_date], note[type=coverage_amount], note[type=color], note[type=ink]{
    visibility: -oxy-collapse-text;
}
/* Keine Tags anzeigen */
msIdentifier, msPart, lb, l, gap, supplied, msIdentifier idno, note, textLang, adminInfo, custodialHist, ab[type=custody], objectType, objectDesc, supportDesc, support, 
desc, note[type=preparation], note[type=color], acquisition, 
condition, origin {
    -oxy-display-tags: none;
}

/* Zusammenklappbar und zusammengeklappt */
facsimile, text {
    -oxy-foldable: true;
    -oxy-folded: true;
}
/* Zusammenklappbar */
teiHeader {
    -oxy-foldable: true;
}


/* Nicht bearbeiten */
/* {
    -oxy-editable: false;
} */

/* Farblich hervorgehobene Blöcke */
/* 1 */
div[type=edition], div[type=translation], div[type=apparatus], div[type=commentary], div[type=bibliography], graphic {
     margin: 0.5em 0;
     background-color: #E3E3E3;
}
div[type=edition]:before, div[type=translation]:before, div[type=apparatus]:before, div[type=commentary]:before, div[type=bibliography]:before,
graphic:before(2) {
    background-color: #79A6D2;
    color: #FFFFFF;
    font-weight: bold;
    vertical-align: top;
    padding: 0.2em 0em 0.2em 0.5em;
}
/* 3 */
msItemStruct {
    background-color: #35628D;
    color: #FFFFFF;
}
msItemStruct * {
    color: #FFFFFF;
}

/* Platzhalter für Text */
note[type=content] p, note[type=general] p, note[type=illustrations] p, note[type=writing_kind] p, 
note[type=structural_markers] p, /* note[type=script] p ,*/ collation p, condition p, note[type=hand_desc] p, provenance p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
}

foliation {
  display: none;
}

/*foliation {
  .pap-block("Folierung");
  .pap-foldable(true);
  
  visibility: -oxy-collapse-text;
     -oxy-append-content: oxy_label(text, "Typ: ", width, 8.5em, text-align, right)
           oxy_textfield(edit, "@type")
           oxy_label(text, "Beschreibung: ", width, 8.5em, text-align, right)
           oxy_textfield(edit, "#text");
}
*/

/* HEADER-Elemente
*******************************************************************************************************************************************/


/* titleStmt */
fileDesc titleStmt title {
    display: block;
    font-weight: bold;
    font-size: 2em;
    margin: 1em 0;
    -oxy-placeholder-content: "Titel des Textträgers (optional)";
}


/************************* RESP **************************/

respStmt {
    -oxy-display-tags: none;
    display: block;
}
respStmt resp {
    display: inline-block;
    -oxy-display-tags: none;
    width: 10em;
    text-align: right;
}
respStmt resp:after {
    content: ": ";
    -oxy-display-tags: none;
}
respStmt name {
    display: inline-block;
    content: oxy_editor(type, text, edit, "#text", columns, 30)
             oxy_editor(type, button, actionID, oxy_xpath('concat("insert_respStmt_", preceding-sibling::resp)'), transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_respStmt, transparent, true, color, #FFFFFF)
             ;
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
}

publicationStmt * {
    display: none;
}

publicationStmt availability {
    display: block;
    content:
        oxy_checkbox(edit, "status", values, "restricted", uncheckedValues, "", labels, "Datensatz für unregistrierte Benutzer verbegen")
    ;
}



/* msDesc, msPart 
*******************************************************************************************************************************************************/

msDesc:before {
    display: block;
    background-color: #004D26;
    color: #FFFFFF;
    content: "Beschreibung des Textträgers"
             oxy_editor(type, button, actionID, insert_info_msDesc, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}

msPart:before {
    display: block;
    background-color: #004D26;
    color: #FFFFFF;
    content: "Textträger-Teil"
             oxy_editor(type, button, actionID, delete_msPart, transparent, true, color, #FFFFFF)
            ;
    vertical-align: middle;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
msDesc { 
    background-color: #FFFFFF;
    display: block;
    border: 1px solid #004D26;
    margin: 2em 0 0.5em 0;
    padding: 0;
    content: oxy_xpath("if (@rend) then concat('\A', @rend) else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
}
msDesc * {
    color: #000000;
}
msPart {
    margin: 2em 0 0.5em 0;
    background-color: #FFFFFF;
    display: block;
    border: 1px solid #004D26;
    -oxy-foldable: true;
}
msDesc:after, msPart:after {
    content: oxy_editor(type, button, actionID, insert_msPart, transparent, true, color, #FFFFFF);
    padding: 0.2em;
    display: block;
    background-color: #004D26;
    color: #FFFFFF;
    vertical-align: middle;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
msPart {
    margin: 1em 2em;
    border-left: 1px solid #527A52;
    border-right: 1px solid #527A52;
    border-bottom: 1px solid #527A52;
    
    .pap-vertical-space();
    
   /* .pap-dropdown(
      @label: "Art",
      @edit: "@type",
      @infotext: "Art des Textträgerteils (optional)."
     );
     
    .pap-textfield(
      @label: "Nummer",
      @edit: "@n",
      @infotext: "Optionaler (alpha)numerischer Identifikatior des Textträgerteils, z.B. Nr. der Kodexlage."
    );*/
}

/* sourceDesc */
msIdentifier > idno {
    margin-top: 1em;
    content: oxy_label(text, "Inventarnummer: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             oxy_editor(type, button, actionID, insert_info_msIdentifier_idno, transparent, true, color, #FFFFFF)
             " " attr("rend");
}
msIdentifier collection {
    display: block;
    -oxy-display-tags: none;
    content: oxy_label(text, "Sammlung: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, true);
    visibility: -oxy-collapse-text;
}

altIdentifier[type="trismegistos"] > idno {
    margin-top: 1em;
    content: oxy_label(text, "Trismegistos-Nummer: ", width, 12em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             " " attr("rend");    
}

altIdentifier[type="trismegistos"]:after {
    margin-top: 1em;
    content: oxy_label(text, "Entspricht Text: ", width, 12em, text-align, right)
             oxy_combobox(edit, "@corresp", editable, false, 
                values, oxy_xpath("string-join(//msItemStruct/@xml:id/concat('#', .), ',')"),
                labels, oxy_xpath("string-join(//msItemStruct/string-join((@xml:id, string-join((locus/text(), (title/text(), '(kein Titel)')[1]), ': ')), ' – '), ',')")
             )
             " " attr("rend");    
}

altIdentifier[type="ddb"] > idno {
    margin-top: 1em;
    content: oxy_label(text, "DDbDp-Nummer: ", width, 12em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             " " attr("rend");    
}

altIdentifier[type="ddb"]:after {
    margin-top: 1em;
    content: oxy_label(text, "Entspricht Text: ", width, 12em, text-align, right)
             oxy_combobox(edit, "@corresp", editable, false, 
                values, oxy_xpath("string-join(//msItemStruct/@xml:id/concat('#', .), ',')"),
                labels, oxy_xpath("string-join(//msItemStruct/string-join((@xml:id, string-join((locus/text(), (title/text(), '(kein Titel)')[1]), ': ')), ' – '), ',')")
             )
             " " attr("rend");    
}

altIdentifier[type="hgv"] > idno {
    margin-top: 1em;
    content: oxy_label(text, "HGV-Nummer: ", width, 12em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             " " attr("rend");    
}

altIdentifier[type="hgv"]:after {
    margin-top: 1em;
    content: oxy_label(text, "Entspricht Text: ", width, 12em, text-align, right)
             oxy_combobox(edit, "@corresp", editable, false, 
                values, oxy_xpath("string-join(//msItemStruct/@xml:id/concat('#', .), ',')"),
                labels, oxy_xpath("string-join(//msItemStruct/string-join((@xml:id, string-join((locus/text(), (title/text(), '(kein Titel)')[1]), ': ')), ' – '), ',')")
             )
             " " attr("rend");    
}


altIdentifier[type="legacy"] > idno {
    margin-top: 1em;
    content: oxy_label(text, "Alte Inventarnummer: ", width, 12em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             oxy_editor(type, button, actionID, insert_info_altIdentifier_idno, transparent, true, color, #FFFFFF)
             " " attr("rend");    
}


/************************************ listBibl *****************************************/

sourceDesc > listBibl:before, msItemStruct > listBibl:before {
    display: block;
    content: 
        "Bibliographie"
        oxy_editor(type, button, actionID, insert_info_listBibl, transparent, true, color, #FFFFFF)
        ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
sourceDesc > listBibl, msItemStruct > listBibl {
    display: block;
    content: oxy_xpath("if (@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    margin: 1em 0;
    border: 1px solid #004D26;
    -oxy-foldable: true;
    -oxy-folded: true;
}
/* listBibl:after {
    content: url(../img/book.png) " Bibliographie bearbeiten";
    color: #000000;
    padding: 1em 0;
    vertical-align: middle;
    link: "http://papyri.uni-koeln.de:8080/apps/papyri/data/wissen/bibl.xml";
} */
listBibl * {
    color: #000000;
}
listBibl > * {
    padding-bottom: 1em;
}
sourceDesc > listBibl > bibl:before, msItemStruct > listBibl > bibl:before {
    display: block;
    content: "Eintrag"
             oxy_editor(type, button, actionID, insert_bibl, transparent, true, color, #000000)
             oxy_editor(type, button, actionID, delete_bibl, transparent, true, color, #000000);
    margin-bottom: 1em;
    padding: 0.2em 0em 0.2em 0.5em;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
}

sourceDesc > listBibl > bibl, msItemStruct > listBibl > bibl {
    display: block;
    content: oxy_label(text, "Werk: ", width, 4.25em, text-align, right)
    /* oxy_editor(type, combo, edit, "@sameAs", editable, false, 
    values, oxy_xpath("string-join(doc('http://papyri.uni-koeln.de:8080/apps/papyri/data/wissen/bibl.xml')//biblStruct/concat('#', @xml:id), ',')"),
    labels, oxy_xpath("string-join(for $bibl in doc('http://papyri.uni-koeln.de:8080/apps/papyri/data/wissen/bibl.xml')//biblStruct/note[@type='short_title'] return normalize-space($bibl), ',')"),
    columns, 40) */
    oxy_editor(type, text, edit, "#text", columns, 50)
        "\A" 
        oxy_label(text, "Typ: ", width, 4.25em, text-align, right)
        oxy_editor(type, combo, edit, "@type", editable, false, values, "Editio_princeps, Edition, Übersetzung, Kommentar, Abbildung, Sonstiges", labels, "Editio princeps, Edition, Übersetzung, Kommentar, Abbildung, Sonstiges", columns, 20)
        ;
    /* oxy_xpath("string-join(doc('/C:/Users/Ulrike/Dropbox/CCeH/Akademie/Papyri/Modellierung/bibl.xml')//*, ',')") */
    margin: 1em 0;
    border: 1px solid #004D26;
    background-color: #FFFFFF;
    -oxy-foldable: true;
    visibility: -oxy-collapse-text;
}
sourceDesc > listBibl > bibl > biblScope:before, msItemStruct > listBibl > bibl > biblScope:before {
    content: oxy_label(text, "Seiten: ", width, 4.25em, text-align, right);
}
sourceDesc > listBibl > bibl > biblScope, msItemStruct > listBibl > bibl > biblScope {
    display: block;
    content: oxy_editor(type, text, edit, "#text", columns, 30);
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
sourceDesc > listBibl > bibl > note:before, msItemStruct > listBibl > bibl > note:before {
    content: oxy_label(text, "Kommentar: ", width, 4.25em, text-align, right);
}
sourceDesc > listBibl > bibl > note, msItemStruct > listBibl > bibl > note {
    display: block;
    content: oxy_editor(type, text, edit, "#text", columns, 30);
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
msContents listBibl {
    margin: 2em 3em;
}
msContents listBibl * {
    color: #000000;
}

/* msContents
************************************************************************************************************************************************************************************/
msContents:before {
    display: block;
    content: "Beschreibung der Texte"
             oxy_editor(type, button, actionID, insert_info_msContents, transparent, true, color, #FFFFFF);
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
msContents {
    display: block;
    margin: 2em;
    counter-reset: itemStruct;
    content: oxy_xpath("if (@rend) then concat('\A', @rend) else ()");
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
}
msContents * {
    color: #000000;
}
msContents:after {
    content: oxy_editor(type, button, actionID, insert_new_text_description, transparent, true, color, #FFFFFF);
    padding: 0.2em;
    display: block;
    background-color: #004D26;
}
msContents respStmt *, msContents note[type=content] *, msContents note[type=general] *, msContents note[type=illustrations] *,
msContents note[type=orig_date] *,
msContents note[type=writing_kind] *, msContents note[type=structural_markers] *, msContents note[type=script] *,
collation *, condition *{
    color: #000000;
}
msItemStruct {
    display: block;
    counter-increment: itemStruct;
    margin: 3em 2em;
    content: "\A"
             oxy_label(text, oxy_xpath(oxy_concat('//altIdentifier[@corresp="#', attr('xml:id'), '"]/concat("TM ", idno)')), width, 10em, text-align, left, styles, "font-weight:'bold';", background-color, transparent) "\A\A"
             oxy_label(text, "Fragmentarisch: ", width, 10em, text-align, right)
             oxy_editor(type, check, edit, "@defective", values, "true", uncheckedValues, "true", labels, "ja", fontInherit, true)
             oxy_editor(type, check, edit, "@defective", values, "false", uncheckedValues, "false", labels, "nein", fontInherit, true);
    vertical-align: middle;
    padding-bottom: 2em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    -oxy-foldable: true;
    -oxy-folded: true;
}
msItemStruct:before {
    display: block;
    content: "Text Nr." counter(itemStruct) " – " attr('xml:id')
             oxy_editor(type, button, actionID, delete_msItemStruct, transparent, true, color, #FFFFFF);
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}


locus {
  content:
        oxy_label(text, "Lokalisierung: ", width, 10em, text-align, right)
        oxy_combobox(edit, "@target", editable, false, width, 10em,
          values, oxy_xpath("string-join(//layout/concat('#', @xml:id), ',')"),
          labels, oxy_xpath("string-join(//layout/replace(normalize-space((desc/text(), @xml:id)[1]), ',', '\\\\,'), ',')")
          
        )
        oxy_editor(type, text, edit, "#text", columns, 30)
        oxy_editor(type, button, actionID, insert_info_msItem_locus, transparent, true, color, #FFFFFF)
        oxy_xpath("if (@rend) then concat('\A\A', @rend) else ()");
}

msItemStruct > locus {
  -oxy-append-content: oxy_button(action, oxy_action(
          name, "Auf Lokalisierungsgruppe umschalten",
          description, "Auf Lokalisierungsgruppe umschalten",
          operation, "InsertOrReplaceFragmentOperation",
          arg-fragment, '<locusGrp xmlns="http://www.tei-c.org/ns/1.0"><locus>${caret}</locus></locusGrp>',
          arg-insertLocation, ".",
          arg-insertPosition, "Replace"
        ));
}

locusGrp {
  .pap-block("Textstellenlokalisierung  " oxy_button(
        fontInherit, true,
        transparent, true,
        color, lightgrey,
        action, oxy_action(
          name, "(Auf Einzellokalisierung umschalten)",
          description, "Auf Einzellokalisierung umschalten",
          operation, "InsertOrReplaceFragmentOperation",
          arg-fragment, '<locus xmlns="http://www.tei-c.org/ns/1.0">${caret}</locus>',
          arg-insertLocation, ".",
          arg-insertPosition, "Replace"
        )));
  .pap-foldable(true);
  
   > locus {
     .pap-insert-delete-buttons-with-inplace-actions(
       @insert_action: oxy_action(
          name, "[+]",
          description, "Textstellenlokalisierung hinzufügen",
          icon, url("${framework}/img/add-16.png"),
          operation, "InsertFragmentOperation",
          arg-fragment, '<locus xmlns="http://www.tei-c.org/ns/1.0">${caret}</locus>',
          arg-insertLocation, ".",
          arg-insertPosition, "After"
        ),
       @remove_action: oxy_action(
          name, "[-]",
          description, "Textstellenlokalisierung entfernen",
          icon, url("${framework}/img/remove-16.png"),
          operation, "DeleteElementOperation",
          arg-elementLocation, ".",
        ),
       @preventRemoveLast: true
     );
   }
}


msItemStruct title {
    display: block;
    color: #000000;
    -oxy-placeholder-content: "Titel des Textes (optional)";
    margin: 1em 0 1em 1.5em;
    font-size: 1.8em;
    font-weight: bold;
}
note[type=content]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Inhalt"
             oxy_editor(type, button, actionID, insert_info_note_summary, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=content] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=availability]{
    display: block;
    content: oxy_label(text, "Publikationsstatus: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit "#text", editable, false)
             oxy_editor(type, button, actionID, insert_info_availability, transparent, true, color, #FFFFFF)
             " " attr("rend");
    visibility: -oxy-collapse-text;
}


note[type=publication] {
    margin-top: 1em;
    margin-bottom: 1em;
}


note[type=publication]:not([subtype=struct]) {
    display: block;
    content: 
            oxy_label(text, "Publikation: ", width, 10em, text-align, right) 
            oxy_editor(type, text, edit, "#text", columns, 30);
    visibility: -oxy-collapse-text;
}


@publicationLabels: oxy_xpath("doc('@{backendUrl}/modules/oxygen-tools.xql?what=choosePub-labels')/data(.)", evaluate, static);
@publicationValues: oxy_xpath("doc('@{backendUrl}/modules/oxygen-tools.xql?what=choosePub-values')/data(.)", evaluate, static);
note[type=publication] idno {
    content:oxy_label(text, "Publikation: ", width, 10em, text-align, right) 
            oxy_combobox(           
            edit, "@corresp",
            editable, false,
            columns, 20,
            labels, @publicationLabels,
            values, @publicationValues,
            tooltips, @publicationLabels,
            onChange, oxy_action(
                name, 'Insert',
                operation, 'XQueryUpdateOperation',
                arg-script, oxy_concat(
                "let $backendURL := '@{backendUrl}'",
                "let $pubId := substring-after(@corresp, '#')",
                "let $pubDesc := doc($backendURL || '/modules/oxygen-tools.xql?what=pubIdno&amp;id=' || $pubId)",
                "return replace value of node . with $pubDesc"
                )
              )
            );
                          
    visibility: -oxy-collapse-text;
}



note[type=publication] > bibl > biblScope {
    display: block;
    margin-left: 9em;
    content: oxy_label(text, "Nummer / Seiten: ", width, 10em, text-align, right)   
             oxy_editor(type, text, edit, "#text", columns, 10);
    visibility: -oxy-collapse-text;
}

note[type=publication]:not([subtype=struct]):after {
    display: block;
    margin-left: 10em;
    content:
        oxy_button(
             actionID, 'change_publication_type_to_structured',
             showText, true,
             transparent, true
        );
}

note[type=publication][subtype=struct]:after(1) {
    display: block;
    margin-left: 10em;
    content:
        oxy_button(
             actionID, 'change_publication_type_to_unstructured',
             showText, true,
             transparent, true
        );
}

note[type=publication][subtype=struct] idno:after{
    display: block;
    margin-top: 2em;
    margin-left: 13em;
    height: 5em;
    width:  90%;
    font-style: italic;
    font-size: small;
    content: oxy_xpath("./text()");
}

note[type=text_type]{
    content: oxy_label(text, "Textsorte: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, false);
    padding-top: 0.4em;
}
note[type=illustrations]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Illustrationen/Zeichnungen/Symbole"
             oxy_editor(type, button, actionID, insert_info_note_illustrations, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=illustrations] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=status]{
    content: oxy_label(text, "Status: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, false);
}


/* Orig-DATE, Orig-PLACE
**************************************************************************/
note[type=orig_date]:before {
    content: "Datierung"
             oxy_editor(type, button, actionID, insert_info_orig_date, transparent, true, color, #FFFFFF)
             ;
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}  
note[type=orig_date] {
    content: oxy_xpath("if (@rend) then concat('\A', @rend, '\A') else ()");
    display: block;
    margin: 2em 3em;
    padding-bottom: 1em;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
    -oxy-foldable: true;
    -oxy-folded: true;
}
note[type=orig_date] date {
    content: oxy_editor(type, check, edit, "@type", values, "Zeitraum", uncheckedValues, "Zeitraum", labels, "Zeitraum", fontInherit, true)
             oxy_editor(type, check, edit, "@type", values, "Zeitpunkt", uncheckedValues, "Zeitpunkt", labels, "Zeitpunkt", fontInherit, true) "\A"
             oxy_label(text, oxy_xpath("if (@type = 'Zeitraum') then 'nicht vor: ' else 'wann: '"), width, 6.75em, text-align, right)
             oxy_editor(type, text, edit, oxy_xpath("if (@type = 'Zeitraum') then '@notBefore' else '@when'"), columns, 10)
             oxy_label(text, oxy_xpath("if (@type = 'Zeitraum') then 'nicht nach: ' else '('"), width, 4.9em, text-align, right)
             oxy_editor(type, text, edit, oxy_xpath("if (@type = 'Zeitraum') then '@notAfter' else '@when'"), columns, "10")
             oxy_xpath("if (@type = 'Zeitpunkt') then ')' else ''")
             " " oxy_editor(type, check, edit, "@cert", values, "low", uncheckedValues, "high", labels, "unsicher", fontInherit, true);
    display: block;
    padding: 0 0 1em 0;
    margin: 1em 1em 0 0;
    border: 1px solid #004D26;
    background-color: #FFFFFF;
    font-size: 1em;
    visibility: -oxy-collapse-text;
}
note[type=orig_date] date:before {
    content: "Datum "
             oxy_editor(type, button, actionID, insert_date, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_date, transparent, true, color, #FFFFFF)
    ;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    vertical-align: middle;
    color: #FFFFFF;
    background-color: #004D26;
    font-weight: bold;
    font-size: 1em;
}
note[type=orig_date] date note {
    content: "\A"
             oxy_label(text, "Kommentar: ", width, 6.75em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
}
note[type=orig_place]:before {
    content: "Herkunft"
             oxy_editor(type, button, actionID, insert_info_orig_place, transparent, true, color, #FFFFFF)
             ;
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}
note[type=orig_place] {
    content: oxy_xpath("if (@rend) then concat('\A', @rend, '\A') else ()");
    display: block;
    padding-bottom: 1em;
    margin: 2em 3em;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
    -oxy-foldable: true;
    -oxy-folded: true;
}
note[type=orig_place] place:before {
    content: "Ort "
             oxy_editor(type, button, actionID, insert_place, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_place, transparent, true, color, #FFFFFF)
    ;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    vertical-align: middle;
    color: #FFFFFF;
    background-color: #004D26;
    font-weight: bold;
    font-size: 1em;
}
note[type=orig_place] place {
    display: block;
    padding: 0 0 1em 0;
    margin: 1em 1em 0 0;
    border: 1px solid #004D26;
    background-color: #FFFFFF;
    font-size: 1em;
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
}
note[type=orig_place] placeName {
    content: oxy_label(text, "Ortsname: ", width, 6.75em, text-align, right)
             /*oxy_editor(type, combo, edit, "#text", editable, false, values, oxy_xpath("string-join(doc('http://papyri.uni-koeln.de:8080/apps/papyri/data/wissen/origPlace.xml')//placeName[@type='preferred'], ',')"))*/
             oxy_editor(type, combo, edit, "#text", columns, 30, editable, true)
             " " oxy_editor(type, check, edit, "@cert", values, "low", uncheckedValues, "high", labels, "unsicher", fontInherit, true) "\A"
             ;
    display: block;
    visibility: -oxy-collapse-text;
}
note[type=orig_place] place note {
    content: oxy_label(text, "Kommentar: ", width, 6.75em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
            ;
    visibility: -oxy-collapse-text;
}
/*
note[type=orig_place]:after, history origPlace:after {
    content: url(../img/edit.png) " Orte bearbeiten";
    padding: 1em 0 0 0;
    vertical-align: middle;
    link: "http://papyri.uni-koeln.de:8080/apps/papyri/data/wissen/origPlace.xml";
    color: #000000;
} */

msItemStruct note[type=general]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Allgemeine Bemerkungen"
             oxy_editor(type, button, actionID, insert_info_note_general_text, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
msItemStruct note[type=general] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}

textLang:before {
    content: "Sprache und Schrift"
             oxy_editor(type, button, actionID, insert_info_textLang, transparent, true, color, #FFFFFF)
             ;
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}  
textLang {
    content: oxy_xpath("if (@rend) then concat('\A', @rend, '\A') else ()");
    display: block;
    margin: 2em 3em;
    padding-bottom: 1em;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
    -oxy-foldable: true;
    -oxy-folded: true;
}

note[type=script]:before {
    content: "Schrift";
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}
note[type=script]{
    display: block;
    margin: 0.5em 0.5em 0 0;
    padding-bottom: 1em;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
}
note[type=script]:after {
    content: oxy_label(text, "Anmerkung: ", width, 10em, text-align, right) oxy_editor(type, text, edit, "#text", columns, 30);
}
note[type=script] term[type=script] {
    display: block;
    content: oxy_label(text, "Schrift: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, true)
             oxy_editor(type, button, actionID, insert_script_term, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_script_term, transparent, true, color, #FFFFFF)
             ;
    visibility: -oxy-collapse-text;
}
note[type=language]:before {
    content: "Sprache";
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}
note[type=language]{
    display: block;
    margin: 0.5em 0.5em 0 0;
    padding-bottom: 1em;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
}
note[type=language]:after {
    content: oxy_label(text, "Anmerkung: ", width, 10em, text-align, right) oxy_editor(type, text, edit, "#text", columns, 30);
}
note[type=language] term[type=language] {
    display: block;
    content: oxy_label(text, "Sprache: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, true)
             oxy_editor(type, button, actionID, insert_language_term, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_language_term, transparent, true, color, #FFFFFF)
             ;
    visibility: -oxy-collapse-text;
}


/**-**/

note[type=writing_direction]{
    display: block;
    content: oxy_label(text, "Schriftrichtung: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, false);
}

note[type=ink]{
    content: oxy_label(text, "Tinte: ", width, 9.75em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
}
note[type=hand_desc]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Beschreibung der Hand"
             oxy_editor(type, button, actionID, insert_info_note_handDesc, transparent, true, color, #FFFFFF);
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=hand_desc] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 1em 2em 0em 2em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=structural_markers]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Gliederungszeichen"
             /* oxy_editor(type, button, actionID, insert_info_note_illustrations, transparent, true, color, #FFFFFF)*/;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=structural_markers] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 0em 2em 1em 2em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}



/* PhysDesc 
******************************************************************************************************************************************/



.pap-info(@text, @scope: "block") {
  &:before(2) {
    .pap-info-button(@scope, false, @text);
  }
  
  @infoTextSelector: ~':-pap-show-info_@{scope}:before';

  &@{infoTextSelector} {
      display: block;
      font-size: 0.8rem;
      padding: 0.5rem;
      content: @text;
  }
}

.pap-remove-info-button(@scope, @lineBreakAfter: true) {
  @lineBreakXPath: 'if ("@{lineBreakAfter}" = "true") then "\A" else ()';

    @action: oxy_action(
      name, 'Hilfe ausblenden', 
      description, 'Hilfe ausblenden', 
      icon, url('${framework}/img/info-16.png'), 
      operation, 'ChangePseudoClassesOperation', 
      arg-removePseudoClassNames, '-pap-show-info_@{scope}'
  );
  
  -oxy-append-content: oxy_button(action, @action, transparent, true);
}

.pap-add-info-button(@scope, @lineBreakAfter: true) {  
  @lineBreakXPath: 'if ("@{lineBreakAfter}" = "true") then "\A" else ()';

  @action: oxy_action(
      name, 'Hilfe einblenden', 
      description, 'Hilfe einblenden', 
      icon, url('${framework}/img/info-16.png'), 
      operation, 'ChangePseudoClassesOperation', 
      arg-setPseudoClassNames, '-pap-show-info_@{scope}'
  );
  
  -oxy-append-content: oxy_button(action, @action, transparent, true);
}

.pap-info-button(@scope: "block", @lineBreakAfter: true, @infotext) {

    @hasInfoButtonSelector: ~":-pap-show-info_@{scope}";
    @hasNoInfoButtonSelector: ~":not(:-pap-show-info_@{scope})";

    &@{hasInfoButtonSelector} when not (@infotext = false) {
     .pap-remove-info-button(@scope, @lineBreakAfter);
    }
    
   &@{hasNoInfoButtonSelector} when not (@infotext = false) {
     .pap-add-info-button(@scope, @lineBreakAfter);
    }
}

.pap-form-control(@label, @edit, @control, @infotext, @editable: false, @columns: 20, @lineBreakAfter: true) {
  @infoScope: replace(replace(@edit, '@', 'attr_'), '#', 'id_');
  @infoScopeSelector: ~':-pap-show-info_@{infoScope}';
  @notInfoScopeSelector: ~':not(:-pap-show-info_@{infoScope})';
  
  @infotextHtml: '@{infotext}';
  
  
  &@{infoScopeSelector}, &@{notInfoScopeSelector} {
    -oxy-append-content:
      oxy_label(text, oxy_concat(@label, ":"), width, 7.25em, text-align, right)
      @control
      ;
 }
 
  .pap-info-button(@infoScope, @lineBreakAfter, @infotext);
      
  &@{infoScopeSelector} when not (@infotext = false) {
     -oxy-append-content: oxy_htmlContent(content, @infotextHtml, width, 100%, fontInherit, true);
  }
  
   &@{infoScopeSelector} when (@lineBreakAfter = true) {
     display: block;
     -oxy-append-content: "\A";
   }
   &@{notInfoScopeSelector} when (@lineBreakAfter = true) {
     display: block;
     -oxy-append-content: "\A";
   }

}

.pap-vertical-space(@height: 18) {
  -oxy-append-content: oxy_htmlContent(content, '<div style="height: @{height}px;"></div>');
}

.pap-dropdown(@label, @edit, @values: false, @infotext: false, @editable: false, @columns: 20, @lineBreakAfter: true, @canRemoveValue: false) when (@values = false) {
  @control: oxy_combobox(edit, @edit, editable, @editable, columns, @columns, canRemoveValue, @canRemoveValue);
  
  .pap-form-control(@label, @edit, @control, @infotext, @editable, @columns, @lineBreakAfter);
}

.pap-dropdown(@label, @edit, @values: false, @infotext: false, @editable: false, @columns: 20, @lineBreakAfter: true, @canRemoveValue: false) when not (@values = false) {
  @control: oxy_combobox(edit, @edit, values, @values, editable, @editable, columns, @columns, canRemoveValue, @canRemoveValue);
  
  .pap-form-control(@label, @edit, @control, @infotext, @editable, @columns, @lineBreakAfter);
}

.pap-dropdown-with-labels(@label, @edit, @values, @labels, @infotext: false, @editable: false, @columns: 20, @lineBreakAfter: true, @canRemoveValue: false) {
   @control: oxy_combobox(edit, @edit, values, @values, labels, @labels, editable, @editable, columns, @columns, canRemoveValue, @canRemoveValue);
  
  .pap-form-control(@label, @edit, @control, @infotext, @editable, @columns, @lineBreakAfter);
}

.pap-textfield(@label, @edit, @infotext: false, @editable: false, @columns: 20, @lineBreakAfter: true) {
  @control: oxy_textfield(edit, @edit, columns, @columns, tooltip, oxy_xpath('"@{infotext}"'));
  
  .pap-form-control(@label, @edit, @control, @infotext, @editable, @columns, @lineBreakAfter);
}


.pap-block(@title) {
  &:before(2) {
    display: block;
    content: @title;
  
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0 0.2em 0.5em;
    margin-bottom: 1em;
  }
  
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
    margin-bottom: 1em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    display: block;
}

.pap-foldable(@folded: false) {
    -oxy-foldable: true;
    -oxy-folded: @folded;
}

.pap-reset-content() {
  content: "";
}

.pap-block-insert-delete-buttons(@insert_action, @remove_action) {
  &:before(2) {
    -oxy-append-content:
        oxy_editor(type, button, actionID, @insert_action, transparent, true, color, #FFFFFF)
        oxy_editor(type, button, actionID, @remove_action, transparent, true, color, #FFFFFF);
  }
}

.pap-insert-delete-buttons-with-inplace-actions(@insert_action, @remove_action, @preventRemoveLast: false) when (@preventRemoveLast = false) {
    -oxy-append-content:
        oxy_button(action, @insert_action, transparent, true, color, #FFFFFF)
        oxy_button(action, @remove_action, transparent, true, color, #FFFFFF);
}

.pap-insert-delete-buttons-with-inplace-actions(@insert_action, @remove_action, @preventRemoveLast: false) when (@preventRemoveLast = true) {
    -oxy-append-content:
        oxy_button(action, @insert_action, transparent, true, color, #FFFFFF);

    &:not(:first-child) {
      -oxy-append-content:    
        oxy_button(action, @remove_action, transparent, true, color, #FFFFFF);
    }
}


physDesc:before {
    content: "Physische Beschreibung";
    display: block;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
physDesc {
   margin: 2em;
   content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
   /* color: #0059B3; */
   -oxy-foldable: true; 
   -oxy-folded: true;
   background-color: #FFFFFF;
   border: 1px solid #004D26;
}
objectType {
    content: oxy_label(text, "Objekttyp: ", width, 7.25em, text-align, right)
              oxy_editor(type, combo, edit, "#text", editable, false);
    padding-top: 1em;
}
msPart objectType {
    content: oxy_label(text, "Objekttyp: ", width, 7.25em, text-align, right)
              oxy_editor(type, combo, edit, "#text", editable, false, canRemoveValue, true);
    padding-top: 1em;
}
objectType:after {
    content: "\A";
}
support > material:before {
    display: block;
    content: "Material";
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
support > material {
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 0 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
material > material:first-child {
    content: oxy_label(text, "Material: ", width, 7.25em, text-align, right)
              oxy_editor(type, combo, edit, "#text", editable, false);
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
    display: block;
}
msPart material > material:first-child {
      content: oxy_label(text, "Material: ", width, 7.25em, text-align, right)
              oxy_editor(type, combo, edit, "#text", editable, false, canRemoveValue, true);
}
material > material[type=note]{
    content: oxy_label(text, "Anmerkung: ", width, 7.25em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 50);
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
    display: block;
    padding-bottom: 1em;
}
dimensions:before {
    display: block;
    content: "Maße"
             oxy_editor(type, button, actionID, insert_info_masse, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
dimensions {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
dimensions > *:first-child {
    margin-top: 1em;
}
width {
    content: oxy_label(text, "Breite: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
}
height {
    content: oxy_label(text, "Höhe: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
}
depth {
    content: oxy_label(text, "Tiefe: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
    padding-bottom: 1em;
}
dim[type=length] {
    content: oxy_label(text, "Länge: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
    padding-bottom: 1em;
    display: block;
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
dim[type=diameter] {
    content: oxy_label(text, "Durchmesser: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
    padding-bottom: 1em;
    display: block;
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
dim[type=circumference]{
    content: oxy_label(text, "Umfang: ", width, 8em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
             " cm\9"
             oxy_editor(type, check, edit, "@scope", values, "ursprünglich", uncheckedValues, "", labels, "ursprünglich", fontInherit, true)
             /* values war bei @atLeast und @atMost vorher: oxy_xpath('replace(., ",", ".")'). Ab Oxygen Version 17.1 scheint ein XPath-
             Ausdruck an dieser Stelle nicht mehr unterstützt zu werden. Daher behelfsmäßig 0 gesetzt, wenn der Wert, der Elementinhalt 
             ist, als "atLeast" oder "atMost" gemeint ist (statt Wiederholung des Wertes selbst) */
             oxy_editor(type, check, edit, "@atLeast", values, '0', uncheckedValues, "", labels, "mindestens", fontInherit, true)
             oxy_editor(type, check, edit, "@atMost", values, '0', uncheckedValues, "", labels, "höchstens", fontInherit, true)
             oxy_editor(type, check, edit, "@precision", values, "medium", uncheckedValues, "", labels, "ca.", fontInherit, true);
    padding-bottom: 1em;
    display: block;
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
note[type=dimensions]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Maße"
             oxy_editor(type, button, actionID, insert_info_note_Masse_B, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=dimensions] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=dimensions] p {
    -oxy-placeholder-content: "Text";
}
note[type=Fragment]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Fragment"
             oxy_editor(type, button, actionID, insert_info_note_Fragment, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=Fragment] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=Blatt]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Blatt"
             oxy_editor(type, button, actionID, insert_info_note_Blatt, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=Blatt] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=Rekto]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Rekto"
             oxy_editor(type, button, actionID, insert_info_note_Rekto, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=Rekto] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=Verso]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Verso"
             oxy_editor(type, button, actionID, insert_info_note_Verso, transparent, true, color, #FFFFFF)
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
note[type=Verso] {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em 3em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}
note[type=Fragment] p, note[type=Blatt] p, note[type=Rekto] p, note[type=Verso] p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
}


note[type=preparation] {
    content: oxy_label(text, "Zurichtung: ", width, 7.25em, text-align, right)
             oxy_editor(type, combo, edit, "#text", editable, true, columns, 30);
}
note[type=preparation]:after {
    content: "\A";
}
note[type=color]{
    content: oxy_label(text, "Farbe: ", width, 7.25em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
}


condition {
  .pap-block(url("../img/edit.png") "Zustand / Erhaltung");
  .pap-foldable();
   margin: 2em 3em;
   > p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
    display: block;
    visibility: unset;
   }
}
collation {
  .pap-block(url("../img/edit.png") "Bindung");
  .pap-foldable();
   margin: 2em 3em;
   > p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
    display: block;
    visibility: unset;
   }
}


collation {
  .pap-block(url("../img/edit.png") "Bindung");
  .pap-foldable();
   margin: 2em 3em;
   > p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
    display: block;
    visibility: unset;
   }
}


layoutDesc > summary {
  .pap-block(url("../img/edit.png") "Beschreibung des Layouts");
  .pap-foldable();
  .pap-info("Beschreibung von Layouteigenschaften (in freier Form).");
   margin: 2em 3em;
   visbility: visible;
   > p {
    padding: 0.5em 0;
    -oxy-placeholder-content: "Text";
    visibility: unset;
    display: block;
   }
}

layout {
  .pap-block("Layoutelement");
  .pap-foldable();
  .pap-block-insert-delete-buttons(insert_layout, delete_layout);
  @infotext: oxy_xpath("doc('${framework}/documentation.html')//*[@id='layout']/*[@class='desc']/normalize-space(.)", evaluate, static);
  .pap-info(@infotext);
  
  
  visibility: -oxy-collapse-text;
  
  content: oxy_label(text, "ID: ", width, 7.25em, text-align, right)
           attr("xml:id");

  note[type=type] {
    @infotext: "Art des Layoutelementes. Es kann zwischen &#39;Fläche&#39; (z.B. Vorderseite, Rückseite) und &#39;Schreibbereich&#39; (z.B. Seite, Kolumne) gewählt werden, wobei &#39;Fläche&#39; einen Teil des physischen Textträgers meint, während &#39;Schreibbereich&#39; eine logische Sicht auf den Textträger meint. Ein &#39;Schreibbereich&#39; kann auf einer &#39;Fläche&#39; lokalisiert sein.";
    .pap-dropdown("Art", "#text", false, @infotext, false, 30);

    padding-bottom: 0.5em;
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
  }
  
  locus {
    .pap-block("Lokalisierung des Schreibbereichs / Kodexlage");
    .pap-reset-content();

    .pap-info("Wurde bei 'Art' des Layoutelementes 'Schreibbereich' ausgewählt, kann hier angegeben werden, auf welcher Fläche des Textträgers sich der Schreibbereich (z.B. die Seite oder Kolumne) befindet und wo er auf der Fläche angeordnet ist.");

    .pap-dropdown-with-labels(
        "Ziel",
        "@target", 
        oxy_xpath("//layout[note[@type = 'type'] = ('Fläche', 'Kodexlage')]/('#' || @xml:id) => string-join(',')"),
        oxy_xpath("//layout[note[@type = 'type'] = ('Fläche', 'Kodexlage')]/(if (desc/text()) then replace(desc, ',', ';') || ' (#' || @xml:id || ')' else '#' || data(@xml:id)) => string-join(',')"),
        "Hier kann angegeben werden, auf welcher Fläche sich der Schreibbereich befindet, indem der Identifikator der zuvor definierten Fläche ausgewählt wird.",
        @canRemoveValue: true
       );
    

      .pap-textfield(
        "Anordnung",
        "@n", 
        "Angabe der Anordnung des Schreibbereichs auf der Fläche, z.B. &lsquo;rechts&rsquo; oder &lsquo;links&rsquo;."
       );
  }
  
  desc {
    @infotext: "&quot;Beschreibung des Layoutelementes, z.B. &#39;Vorderseite&#39;, &#39;Rückseite&#39;, &#39;Recto&#39;, &#39;Verso&#39; bei einer Fläche oder &#39;Seite 1&#39;, &#39;Seite 2&#39;, &#39;erste Kolumne&#39; etc. bei einem Schreibbereich&quot;";
    .pap-textfield("Beschreibung", "#text", @infotext, false, 30);
  
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
  }
  
  .pap-textfield("Nummer", "@n", "Optionaler (alpha-)numerischer Identifikator des Layoutelements (z.B. Seitenzahl bei Kodizes).", false, 30);
}


/* History 
******************************************************************************************************************************************/
history:before {
    content: "Provenienz und Erwerb";
    display: block;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
history {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}


/** provenance **/
provenance:before {
    content: "Provenienz"
             oxy_editor(type, button, actionID, insert_info_provenance, transparent, true, color, #FFFFFF)
             ;
    display: block;
    padding: 0 0 0 0.3em;
    vertical-align: top;
    background-color: #004D26;
    color: #FFFFFF;
    font-size: 1em;
    font-weight: bold;
}
provenance {
    content: oxy_xpath("if (@rend) then concat('\A', @rend, '\A') else ()");
    display: block;
    padding-bottom: 1em;
    margin: 0.5em 1em 0.5em 0;
    color: #000000;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
    font-size: 1em;
    -oxy-foldable: true;
}    
provenance note[type=provenance]{
    
}



/** acquisition **/
acquisition note[type=acquisition_type]{
    content: oxy_label(text, "Erwerbungstyp: ", width, 8.5em, text-align, right)
             oxy_editor(type, combo, edit, "#text", columns, 30);
    display: block;
}

acquisition note[type=finding_place]{
    content: oxy_label(text, "Fundort: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=finding_date]{
    content: oxy_label(text, "Funddatum: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=finder]{
    content: oxy_label(text, "FinderIn: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}

acquisition note[type=buying_place]{
    content: oxy_label(text, "Kaufort: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=buying_date]{
    content: oxy_label(text, "Kaufdatum: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=buyer] {
    content: oxy_label(text, "KäuferIn: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=seller]{
    content: oxy_label(text, "VerkäuferIn: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=donor]{
    content: oxy_label(text, "SchenkerIn: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=donation_place]{
    content: oxy_label(text, "Schenkungsort: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=donation_date]{
    content: oxy_label(text, "Schenkungsdatum: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}

acquisition note[type=folder]{
    content: oxy_label(text, "Mappe: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=box]{
    content: oxy_label(text, "Kiste: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}

acquisition note[type=drawing_date]{
    content: oxy_label(text, "Verlosungstag: ", width, 8.5em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    display: block;
}
acquisition note[type=general]:before {
    display: block;
    content: url("../img/edit.png") " "
            "Anmerkung zum Erwerb"
             /* oxy_editor(type, button, actionID, insert_info_note_illustrations, transparent, true, color, #FFFFFF)*/
             ;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
acquisition note[type=general]{
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 1em 1em 1em 0;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}



/* Additional 
******************************************************************************************************************************************/

additional:before {
    content: "Aufbewahrung";
    display: block;
    vertical-align: middle;
    background-color: #004D26;
    color: #FFFFFF;
    font-weight: bold;
    padding: 0.2em 0em 0.2em 0.5em;
}
additional {
    content: oxy_xpath("if(@rend) then concat('\A', @rend, '\A') else ()");
    /* color: #0059B3; */
    -oxy-foldable: true;
    -oxy-folded: true;
    margin: 2em;
    background-color: #FFFFFF;
    border: 1px solid #004D26;
}


ab[type=custody] {
    content: oxy_label(text, "Aufbewahrung: ", width, 11em, text-align, right)
             /*oxy_editor(type, text, edit, "#text", columns, 30)*/
             oxy_editor(type, combo, edit, "#text", editable, true, columns, 30);
    padding-top: 1em;
}
ab[type=custody]:after {
    content: "\A";
}
note[type=coverage_amount]{
    content: oxy_label(text, "Versicherungssumme: ", width, 11em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30);
    padding-bottom: 1em;
}

/* TEXT-Elemente
**********************************************************************************************************************************************/
div[type=edition]:before, div[type=translation]:before, div[type=apparatus]:before, div[type=commentary]:before, div[type=bibliography]:before {
    vertical-align: middle;
}
div[type=edition]:before {
    content: 
        "Edition"
        ;
}
div[type=edition] div[type=edition]:before {
    content: "Transkription";
}
div[type=translation]:before {
    content: 
        "Übersetzung"
        ;
}
div[type=apparatus]:before {
    content: 
        "Apparat"
        ;
}
div[type=commentary]:before {
    content: 
        "Kommentar"
        ;
}
div[type=bibliography]:before {
    content: 
        "Bibliographie"
        ;
}
body:before {
    content: "";
}
div[type=edition], div[type=translation], div[type=apparatus], div[type=commentary], div[type=bibliography]{
    padding-bottom: 1em;
}
div[type=edition] > div, div[type=translation] > div, div[type=apparatus] > div, div[type=commentary] > div, div[type=bibliography] > div {
   margin: 1em 0.5em;
}
div[type=textpart]{
    /* -oxy-placeholder-content: "Abschnitt"; */
}
body ab {
    -oxy-placeholder-content: "Abschnitt";
    border: 1px solid #BBBBBB;
    padding: 0.3em;
    margin: 0.5em 0;
}
body p {
    -oxy-placeholder-content: "Absatz";
    padding: 0 0.5em;
    margin: 0.5em 0;
}
body lg {
    counter-reset: line;
    border: 1px solid #BBBBBB;
    padding: 0.3em;
    margin: 0.5em 0;
}
body lb {
    counter-increment: line;
}
body lb:before {
    content: counter(line);
    color: #663399;
    font-size: smaller;
    padding-right: 1em;
    display: inline;
}
body l {
  background-color: #FFE6CC;   
  -oxy-placeholder-content: "Vers";
}
body gap {
    content: "[ ]";
    padding: 0 0.2em;
}
body supplied:before {
    content: "[";
}
body supplied:after {
    content: "]";
}

/* FAKSIMILE
************************************************************************************************************************************************/

surface {
   content:         
        oxy_button(action, oxy_action(
          name, "Bildverknüpfungen aktualisieren",
          operation, 'JSOperation',
                arg-script, oxy_concat(
                
                // JA, das ist Javascript-Code in einer SCSS-Datei der Java-Code ausführt.
                
                "function doOperation() {",
                "  const IOUtils = Packages.org.apache.commons.io.IOUtils;"
                
                "  const dialog = makeWaitingDialog();"

                "  const documentController = authorAccess.getDocumentController();"
                "  const rootElem = documentController.getAuthorDocumentNode().getRootElement();"
                "  const xmlId = rootElem.getAttribute('xml:id').getValue();"
                
                   // make connection and load responses in a new thread to keep UI responsive
                   // and to be able to show the waiting dialog
                "  const thread = new Packages.java.lang.Thread(function() {"
                "  try {"
                     // connect to backend
                "    const conn = new Packages.java.net.URL('@{backendUrl}/modules/oxygen-tools.xql?what=graphics&id=' + xmlId).openConnection();"
                "    conn.setReadTimeout(0);"
                "    conn.connect();"
                
                     // read response
                "    const is = conn.getInputStream();"
                "    const writer = new Packages.java.io.StringWriter();"
                "    IOUtils.copy(is, writer, 'UTF-8');"
                "    const result = writer.toString();"
                
                     // hide waiting dialog
                "    dialog.setVisible(false);"
                
                     // insert new tei:graphic elements into document (on main thread)
                "    Packages.javax.swing.SwingUtilities.invokeAndWait(new Packages.java.lang.Runnable({"
                "      run: function() { "
                "        try {"
                "          insertXMLResult(documentController, result)"
                "        }  catch (exception) {"
                "          dialog.dispose();"
                "          authorAccess.getWorkspaceAccess().showErrorMessage('Fehler: ' + exception.toString());"
                "          return;"
                "        }"
                "      }})"
                "    );"
                
                " } catch (exception) {"
                "    dialog.dispose();"
                "    authorAccess.getWorkspaceAccess().showErrorMessage('Fehler: ' + exception.toString());"
                "    return;"
                " }"
                
                "});"
                
                // first start the worker thread, then show waiting dialog
                " thread.start();"
                " dialog.setVisible(true);  "
                "}"
                
                "function makeWaitingDialog() {"
                "  const JOptionPane = Packages.javax.swing.JOptionPane;"
                "  const JDialog = Packages.javax.swing.JDialog;"
                "  const pane = new JOptionPane('Bildverknüpfungen werden aktualisiert. Dies kann etwas dauern...', JOptionPane.INFORMATION_MESSAGE, JOptionPane.DEFAULT_OPTION, null, [], null);"
                "  const parentFrame = authorAccess.getWorkspaceAccess().getParentFrame();"
                "  const dialog = new JDialog(parentFrame);"
                "  dialog.setContentPane(pane);"
                "  dialog.pack();"
                "  dialog.setLocationRelativeTo(parentFrame);"
                "  dialog.setModal(true);"
                "  return dialog;"
                "}"
                
                "function insertXMLResult(documentController, result) {"
                 "  const nodes = documentController.findNodesByXPath('//surface', true, true, true);"
                 "  const surfaceNodes = Packages.java.util.Arrays.asList(nodes);"
                 
                 "  if (surfaceNodes == null || surfaceNodes.isEmpty()) {"
                 "    authorAccess.getWorkspaceAccess().showErrorMessage('Fehler: Kein surface-Element gefunden');"
                 "    return;"
                 "  }"
                 
                 "  const surfaceNode = surfaceNodes.get(0);"
                 "  const start = surfaceNode.getStartOffset();"
                 "  const end = surfaceNode.getEndOffset();"
                 "  documentController.beginCompoundEdit();",
                 "  documentController.delete(start, end);"
                 "  documentController.insertXMLFragmentSchemaAware(result, start);",         
                 "  documentController.endCompoundEdit();"
                 
                 "  authorAccess.getWorkspaceAccess().showStatusMessage('Bildverknüpfungen aktualisiert.');"                 
                 "}"
                )
        ),
          transparent, true
        )
}


graphic > desc[type="type"][subtype="thumb"], graphic > desc[type="type"][subtype="preview"] {
    display: none;
}

graphic[url]:before(2) {
    content: 
        "Bild: " oxy_unescapeURLValue(oxy_substring(oxy_substring(attr(url), oxy_lastindexof(attr(url), "/")), 1))
        oxy_concat(" (", attr(mimeType),")")
        ;
    vertical-align: middle;
    display: block;
    
}

graphic:before(1) {
    content: oxy_url(oxy_concat(attr(url), "?thumb=1"));
    text-align: right;
    position: absolute;
}

graphic {

    @values: oxy_xpath("string-join(//layout/concat('#', @xml:id), ',')");
    @labels: oxy_xpath("string-join(//layout/(desc[normalize-space(.) != '']/data(.), concat('#', @xml:id))[1], ',')");
    
    content:  
        /* "\A\A"
        "\9\9\9" oxy_url(attr(url)) */
        "\A"
        oxy_label(text, "bezieht sich auf: ", width, 8.5em, text-align, right)
        oxy_popup(
         edit, '@corresp',
         values, @values,
         labels, @labels,
         tooltips, @values,
         rendererSeparator, ", ",
        selectionMode, multiple);
    padding-bottom: 1em;
    margin-bottom: 1em;
}

graphic desc[type="description"] {
    content: oxy_label(text, "Beschreibung: ", width, 8.5em, text-align, right)
            oxy_editor(type, text, edit, "#text", columns, 30)
}

graphic desc[type="preferred"] {
    content: oxy_label(text, "Bevorzugt: ", width, 8.5em, text-align, right)
             oxy_editor(type, check, edit, "@subtype", values, "true", uncheckedValues, "false", labels, "ja");
}

graphic desc[type="size"] {
    content: oxy_label(text, "Größe: ", width, 8.5em, text-align, right)
            oxy_editor(type, text, edit, "#text", columns, 10, text-align, right);
    -oxy-editable: false;
}

graphic desc[subtype="bytes"] {
    display: none;
}

graphic desc[type="type"] {
    display: none;
}

graphic desc[type="modified"] {
    content: oxy_label(text, "Zuletzt geändert:", width, 8.5em, text-align, right)
            oxy_editor(type, text, edit, "#text", columns, 30, text-align, right);
    -oxy-editable: false;
}

/* REGISTER
**************************************************************************************************************************************************/


/* ORTSREGISTER
*************************************************************************************************************************************************/
TEI[style=index]:before {
    content: "";
}
TEI[style=index] teiHeader {
    display: none;
}
TEI[style=index] text[type=listPlace]:before {
    content: "ORTSREGISTER";
}
TEI[style=index] text[type=listPlace]{
     -oxy-folded: false;
}
TEI[style=index] text[type=listPlace] body {
    padding: 0;
    margin: 1em;
}
TEI[style=index] place {
    content: oxy_xpath("if (@rend) then '&#x00A0;' else ()") attr("rend");
    color: #888888;
    display: block;
    border: 1px solid #004D26;
    margin-bottom: 1em;
    visibility: -oxy-collapse-text;
}
TEI[style=index] place * {
    color: #000000;
}
TEI[style=index] place:before {
    content: "Ort (ID: "
             attr("xml:id") ") "
             oxy_editor(type, button, actionID, insert_index_place, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_index_place, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, insert_info_index_place, transparent, true, color, #FFFFFF)
             ;
    color: #FFFFFF;
    background-color: #004D26;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    font-weight: bold;
    vertical-align: middle;
    font-size: 1em;
}
TEI[style=index] place placeName {
    content: oxy_label(text, "Name: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             oxy_label(text, "Sprache: ", width, 6em, text-align, right)
             oxy_editor(type, popupSelection, edit, "@xml:lang", values, "egy, ara, arc, egy-Egyd, egy-Egyh, cop, grc, heb, lat", fontInherit, true, labels, "Ägyptisch, Arabisch, Aramäisch, Demotisch, Hieratisch, Koptisch, Griechisch, Hebräisch, Latein", editable, false, selectionMode, "single", columns, 10)
             oxy_editor(type, button, actionID, insert_index_placeName, transparent, true, color, #FFFFFF, fontInherit, true)
             oxy_editor(type, button, actionID, delete_index_placeName, transparent, true, color, #FFFFFF, fontInherit, true);
    display: block;
    visibility: -oxy-collapse-text;
    vertical-align: middle;
    margin: 0.5em 0;
    font-size: 1em;
}

TEI[style=index] place placeName[type=preferred] {
    content: oxy_label(text, "Name (bevorzugt): ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             oxy_label(text, "Sprache: ", width, 6em, text-align, right)
             oxy_editor(type, popupSelection, edit, "@xml:lang", values, "egy, ara, arc, egy-Egyd, egy-Egyh, cop, grc, heb, lat", fontInherit, true, labels, "Ägyptisch, Arabisch, Aramäisch, Demotisch, Hieratisch, Koptisch, Griechisch, Hebräisch, Latein", editable, false, selectionMode, "single", columns, 10)
             oxy_editor(type, button, actionID, insert_index_placeName, transparent, true, color, #FFFFFF, fontInherit, true)
             ;
    font-weight: bold;
}
TEI[style=index] place placeName[type=preferred]:after {
    content: oxy_editor(type, button, actionID, insert_info_index_place_namePreferred, transparent, true, color, #FFFFFF)
             oxy_xpath("if (@rend) then '\A&#x00A0;' else ()") attr("rend");
    font-weight: normal;
    color: #888888;
}
TEI[style=index] place location geo {
    content: oxy_label(text, "Geokoordinaten: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             ;
    display: block;
    visibility: -oxy-collapse-text;
    margin-bottom: 0.5em;
}
TEI[style=index] place location geo:after {
    content: oxy_editor(type, button, actionID, insert_info_index_place_geo, transparent, true, color, #FFFFFF)
             oxy_xpath("if (@rend) then '\A&#x00A0;' else ()") attr("rend");
    color: #888888;
}
TEI[style=index] place > idno:before {
    content: oxy_label(text, "Identifikatoren: ", width, 10em, text-align, right)
             oxy_editor(type, button, actionID, insert_info_index_place_idno, transparent, true, color, #FFFFFF);
    color: #000000;
    font-weight: bold;
}
TEI[style=index] place > idno {
    content: oxy_xpath("if (@rend) then '\A&#x00A0;' else ()") attr("rend");
    color: #888888;
    display: block;
    visibility: -oxy-collapse-text;
}
TEI[style=index] place idno idno {
    content: oxy_label(text, "ID: ", width, 10em, text-align, right)
             oxy_editor(type, combo, edit, "@type", values, "TGN, Pleiades, GND, TM")
             oxy_editor(type, text, edit, "#text", columns, 15)
             oxy_editor(type, button, actionID, insert_index_idno, transparent, true, color, #FFFFFF, fontInherit, true)
             oxy_editor(type, button, actionID, delete_index_idno, transparent, true, color, #FFFFFF, fontInherit, true)
             ;
    display: block;
    visibility: -oxy-collapse-text;
    vertical-align: bottom;
}
TEI[style=index] place note {
    content: oxy_label(text, "Anmerkung: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
             ;
    display: block;
    visibility: -oxy-collapse-text;
    margin: 0.5em 0 1em 0;
}

/* BIBLIOGRAPHIE
******************************************************************************************************************************************/
TEI[style=index] listBibl:before {

    content: "BIBLIOGRAPHISCHE LISTE: " 
             oxy_xpath("head/title/text()")
    ;

    color: #FFFFFF;
    background-color: #336699;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    font-weight: bold;
    vertical-align: middle;
    font-size: 1em;
}
TEI[style=index] listBibl {
    display: block;
    -oxy-foldable: true;
    -oxy-folded: true;
    margin-bottom: 2em;
}

TEI[style=index] listBibl title {
    content: oxy_label(text, "Titel: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
    ;
    display: block;
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
}

TEI[style=index] listBibl idno {
    content: oxy_label(text, "Interner Schlüssel: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 15)
    ;
}

TEI[style=index] listBibl body {
    padding: 0;
    margin: 1em;
}

TEI[style=index] text:before {
    content: "BIBLIOGRAPHIE";
}

TEI[style=index] text {
    -oxy-folded: false;
}

TEI[style=index] biblStruct {
    content: oxy_xpath("if (@rend) then '\A\A&#x00A0;' else ()") attr("rend") oxy_xpath("if (@rend) then '\A' else ()");
    color: #000000;
    display: block;
    border: 1px solid #004D26;
    margin: 0 0 1em 2em;
    vertical-align: middle;
    -oxy-foldable: true;
    -oxy-folded: true;
}


TEI[style=index] biblStruct[type="manuscript_publication"]:before {
    content: "Eintrag: "
             oxy_xpath(".//title[@type='main'][1]/text()")
             " (ID: "
             attr("xml:id") ") "
             oxy_editor(type, button, actionID, insert_manuscript_publication, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_index_bibl, transparent, true, color, #FFFFFF)
             /* oxy_editor(type, button, actionID, insert_info_index_bibl, transparent, true, color, #FFFFFF) */
             ;
    color: #FFFFFF;
    background-color: #004D26;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    font-weight: bold;
    vertical-align: middle;
    font-size: 1em;
}


TEI[style=index] listBibl title[type=main] {
    margin-top: 1em;
}

TEI[style=index] listBibl title[type=short] {
    content: oxy_label(text, "Kurztitel: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
    ;
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
}

TEI[style=index] listBibl edition {
    content: oxy_label(text, "Auflage: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 30)
    ;
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
}

TEI[style=index] biblStruct note[type=short_title]{
    display: block;
    content: oxy_label(text, "Kurztitel: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 60)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct note[type=citation]{
    display: block;
    content: oxy_label(text, "Zitierform: ", width, 10em, text-align, right)
             oxy_textArea(edit, "#text", columns, 60, rows, 4)
             ;
    white-space: pre-wrap;
    margin-top: 2em;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct note[type=description]{
    display: block;
    content: oxy_label(text, "Beschreibung: ", width, 10em, text-align, right)
             oxy_textArea(edit, "#text", columns, 60, rows, 4)
             ;
    margin-top: 2em;
    white-space: pre-wrap;    
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct title[level=a]{
    display: block;
    content: oxy_label(text, "Titel (Aufsatz): ", width, 14em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct title[level=j]{
    display: block;
    content: oxy_label(text, "Titel (Zeitschrift): ", width, 14em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct title[level=m]{
    display: block;
    content: oxy_label(text, "Titel (Monographie): ", width, 14em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct[type=Reihe] title[level=s]{
    display: block;
    content: oxy_label(text, "Titel (Reihe): ", width, 14em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct[type=Monographie] title[level=s]{
    display: block;
    content: oxy_label(text, "Reihe: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 60);
    visibility: -oxy-collapse-text;
}

/******************************************** author, editor ***********************************************/
TEI[style=index] biblStruct author:before {
    content: "AutorIn: "
             oxy_editor(type, button, actionID, delete_index_author, transparent, true, color, #FFFFFF)
             /* oxy_editor(type, button, actionID, insert_info_index_place, transparent, true, color, #FFFFFF) */
             ;
    color: #FFFFFF;
    background-color: #336699;
    display: block;
    margin-bottom: 1em;
    padding: 0 0.2em;
    font-weight: bold;
    vertical-align: middle;
    font-size: 1em;
}
TEI[style=index] biblStruct author {
    display: block;
    border: 1px solid #004D26;
    margin: 1em 1em 1em 4em;
    padding: 0em 0em 1em 0em;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct forename {
    display: block;
    content: oxy_label(text, "Vorname: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 20)
             oxy_editor(type, button, actionID, insert_index_forename, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_index_forename, transparent, true, color, #FFFFFF);
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
    padding: 0;
    margin: 0;
}
TEI[style=index] biblStruct surname {
    display: block;
    content: oxy_label(text, "Nachname: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 20)
             oxy_editor(type, button, actionID, insert_index_surname, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_index_surname, transparent, true, color, #FFFFFF);
    visibility: -oxy-collapse-text;
    -oxy-display-tags: none;
    padding: 0;
    margin: 0;
}
TEI[style=index] biblStruct editor:before {
    content: "HerausgeberIn: "
             oxy_xpath("string-join(persName/*, ' ')")
             oxy_editor(type, button, actionID, insert_index_editor, transparent, true, color, #FFFFFF)
             oxy_editor(type, button, actionID, delete_index_editor, transparent, true, color, #FFFFFF)
             /* oxy_editor(type, button, actionID, insert_info_index_editor, transparent, true, color, #FFFFFF) */;
    color: #FFFFFF;
    background-color: #336699;
    display: block;
    padding: 0 0.2em;
    font-weight: bold;
    vertical-align: middle;
    font-size: 1em;
}
TEI[style=index] biblStruct editor {
    display: block;
    width: 40em;
    border: 1px solid #004D26;
    margin: 1em 1em 1em 4em;
    padding: 0em 0em 0em 0em;
    -oxy-display-tags: none;
    -oxy-foldable: true;
    -oxy-folded: true;
    visibility: -oxy-collapse-text;
}

TEI[style=index] biblStruct editor:first-of-type {
    
    margin-top: 2em;

}

TEI[style=index] biblStruct editor note, TEI[style=index] biblStruct author note {
    display: block;
    padding-left: 1em;
    -oxy-display-tags: none;
    visibility: visible;
    -oxy-editable: false;
}
TEI[style=index] biblStruct persName {
    display: block;
    -oxy-display-tags: none;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct note {
    display: block;
}

TEI[style=index] biblStruct ref[type=feature_link] {
      .pap-textfield(
        "Link zur Übersicht",
        "@target",
        "Die Weboberfläche der Datenbank bietet eine Liste von Publikationen. Publikationen, denen Datensätze zugeordnet sind, erscheinen als Link. Dieser Link führt normalerweise auf eine generierte Liste der zugeordneten Datensätze. Ist in diesem Datensatz ein Link eingetragen (z.B. auf eine Ausgewählte Stücke-Seite), wird dieser als Publikationslink genutzt.",
        @columns: 40
      );
}
/******************************** imprint ****************************************/


TEI[style=index] biblStruct imprint pubPlace {
    display: block;
    content: oxy_label(text, "Erscheinungsort: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 20)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct imprint date {
    display: block;
    content: oxy_label(text, "Erscheinungsjahr: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 20)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct imprint publisher {
    display: block;
    content: oxy_label(text, "Verlag: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 20)
             ;
    visibility: -oxy-collapse-text;
}
/******************************** biblScope *************************************/
TEI[style=index] biblStruct biblScope:before {
    display: none;
}
TEI[style=index] biblStruct biblScope[unit=pp]{
    display: block;
    content: oxy_label(text, "Seiten: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 10)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct biblScope[unit=vol]{
    display: block;
    content: oxy_label(text, "Band/Jahrgang: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 10)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct biblScope[unit=issue]{
    display: block;
    content: oxy_label(text, "Ausgabe/Nummer: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 10)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct biblScope[unit=chapter]{
    display: block;
    content: oxy_label(text, "Kapitel: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 10)
             ;
    visibility: -oxy-collapse-text;
}
TEI[style=index] biblStruct biblScope[unit=part]{
    display: block;
    content: oxy_label(text, "Teil: ", width, 14em, text-align, right)
             oxy_editor(type, text, edit, "#text", columns, 10)
             ;
    visibility: -oxy-collapse-text;
}

/******************************** series *************************************/

TEI[style=index] biblStruct series title {
    display: block;
    content: oxy_label(text, "Titel der Reihe: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    margin-top: 2em;
    visibility: -oxy-collapse-text;
}

TEI[style=index] biblStruct series biblScope {
    display: block;
    content: oxy_label(text, "Band: ", width, 10em, text-align, right)
             oxy_editor(type, text, edit "#text", columns, 60)
             ;
    margin-top: 0;
    visibility: -oxy-collapse-text;
}

/* *** Inline Documentation Elements *** */

encodingDesc p {
  margin-bottom: 1em;
  
  hi {
    -oxy-display-tags: none;
  }
  
  lb:before{
      content:"";
  }

}

tag, gi, att, val {
  font-family: monospace;
  -oxy-display-tags: none;
}

val {
  font-style: italic;
}

/* EncodingDesc */

encodingDesc {
  .pap-block("Hinweise zur Kodierung / Modellierung des Datensatzes");
  .pap-foldable();
  
  .pap-info("Für komplexere Datensätze kann hier optional eine Freitextbeschreibung der Kodierung des Datensatzes angegeben werden, beispielsweise: Was bedeutet hier ein Textträgerteil (Fragment, Kodexlage, Seite?), wie sind einzelne Objektelemente (Seiten, Lagen, Schreibbereiche, Abbildungen) miteinander verknüpft?");

  
  visibility: visible;
}

